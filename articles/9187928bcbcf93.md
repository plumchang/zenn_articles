---
title: "UnityStandaloneFileBrowserã‚’ä½¿ã£ã¦ã¿ãŸ"
emoji: "ğŸ“"
type: "tech"
topics:
  - "csharp"
  - "unity"
published: true
published_at: "2022-08-31 20:29"
---

Unityã§ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã€æ–¹æ³•ã‚’èª¿ã¹ã¦ã„ãŸã¨ã“ã‚ä»¥ä¸‹ï¼’ã¤ã®æ–¹æ³•ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚ï¼ˆä»–ã«ã‚‚ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ç­†è€…ãŒèª¿ã¹ãŸç¯„å›²ã§è¦‹ã¤ã‹ã£ãŸã‚‚ã®ã¯ä»¥ä¸‹ã§ã—ãŸï¼‰
- [OpenFileDialog](https://docs.microsoft.com/ja-jp/dotnet/api/system.windows.forms.openfiledialog?redirectedfrom=MSDN&view=windowsdesktop-6.0)
- [UnityStandaloneFileBrowser](https://github.com/gkngkc/UnityStandaloneFileBrowser)

`OpenFileDialog`ã¯.NETã®ã‚¯ãƒ©ã‚¹ãªã®ã§ã€Windowsãƒ“ãƒ«ãƒ‰å‘ã‘ã«ã—ã‹åˆ©ç”¨ã§ããªã„æ¨¡æ§˜ã€‚ä»Šå›ã¯ã€WebGLãƒ“ãƒ«ãƒ‰ã§åˆ©ç”¨ã—ãŸã‹ã£ãŸãŸã‚ã€`UnityStandaloneFileBrowser`ã‚’è©¦ã™ã“ã¨ã«ã—ã¾ã—ãŸã€‚
`UnityStandaloneFileBrowser`ã¯ã€å„OSï¼ˆWindows,Mac,Linux ï¼‰ãƒ“ãƒ«ãƒ‰ã€WebGLãƒ“ãƒ«ãƒ‰ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

# ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ä½œæˆ

æœ¬è¨˜äº‹åŸ·ç­†æ™‚ã«ãŠã‘ã‚‹ç’°å¢ƒæƒ…å ±ã¯ä»¥ä¸‹ã§ã™ã€‚
- OS: `macOS Monterey ãƒãƒ¼ã‚¸ãƒ§ãƒ³12.5.1`
- Unity Editor: `ãƒãƒ¼ã‚¸ãƒ§ãƒ³2021.3.5f`

ãªãŠã€ä»Šå›ä½œæˆã—ãŸã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã¯ä»¥ä¸‹ã«ç½®ã„ã¦ã„ã¾ã™ã€‚
https://github.com/plumchang/UnityStandaloneFileBrowser_webgl_sample

## UnityStandaloneFileBrowserã®å°å…¥

1. `UnityStandaloneFileBrowser`ã®Githubãƒšãƒ¼ã‚¸ã®[Download Package](https://github.com/gkngkc/UnityStandaloneFileBrowser/releases/download/1.2/StandaloneFileBrowser.unitypackage)ã‚ˆã‚Šã€`StandaloneFileBrowser.unitypackage`ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

1. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ`StandaloneFileBrowser.unitypackage`ã‚’Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/fa8c4c1508b4-20220831.png)
	
ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã¾ã—ãŸãŒã€ä¸€æ—¦ç„¡è¦–ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/07458b8bc92a-20220831.png)

## GameObjectã®é…ç½®

`Canvas`ã¨ãã®ä¸‹ã«`Panel`ã‚’ä½œæˆã€‚ã•ã‚‰ã«ãã®ä¸‹ã«`Load`ã¨`Save`ã®ãƒœã‚¿ãƒ³ã€ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›ç”¨ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚é…ç½®ã¯é©å½“ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/b948cf80fbca-20220831.png)

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

`Assets`ãƒ•ã‚©ãƒ«ãƒ€ã®ä¸‹ã«`Scripts`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã€‚  
`Scripts`é…ä¸‹ã«ã€`FileLoadSample.cs`ã¨`FileSaveSample.cs`ã®ï¼’ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```csharp: FileLoadSample.cs
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using SFB;
using System.IO;
using System.Text;
using System.Runtime.InteropServices;
using UnityEngine.Networking;
using UnityEngine.UI;
using UnityEngine.EventSystems;

[RequireComponent(typeof(Button))]
public class FileLoadSample : MonoBehaviour, IPointerDownHandler
{
    // ãƒ†ã‚­ã‚¹ãƒˆã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ
    [SerializeField] private Text outputText;

    // èª­ã¿è¾¼ã‚“ã ãƒ†ã‚­ã‚¹ãƒˆ
    private string _loadedText = "";

#if UNITY_WEBGL && !UNITY_EDITOR
    //
    // WebGL
    //

    // StandaloneFileBrowserã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‹ã‚‰å‘¼ã³å‡ºã™
    [DllImport("__Internal")]
    private static extern void UploadFile(string gameObjectName, string methodName, string filter, bool multiple);

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
    public void OnPointerDown(PointerEventData eventData) {
        UploadFile(gameObject.name, "OnFileUpload", ".", false);
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã®å‡¦ç†
    public void OnFileUpload(string url) {
        StartCoroutine(Load(url));
    }

#else
    //
    // OSãƒ“ãƒ«ãƒ‰ & Unity editorä¸Š
    //
    public void OnPointerDown(PointerEventData eventData) { }

    void Start()
    {
        var button = GetComponent<Button>();
        button.onClick.AddListener(() => OpenFile());
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã
    public void OpenFile()
    {
        // æ‹¡å¼µå­ãƒ•ã‚£ãƒ«ã‚¿
        var extensions = new[] {
            new ExtensionFilter("All Files", "*" ),
        };

        // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
        var paths = StandaloneFileBrowser.OpenFilePanel("Open File", "", extensions, false);
        if (paths.Length > 0 && paths[0].Length > 0)
        {

            StartCoroutine(Load(new System.Uri(paths[0]).AbsoluteUri));

        }
    }

#endif
    // ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
    private IEnumerator Load(string url)
    {
        var request = UnityWebRequest.Get(url);

        var operation = request.SendWebRequest();
        while (!operation.isDone)
        {
            yield return null;
        }

        _loadedText = request.downloadHandler.text;
        Debug.Log(_loadedText);
        outputText.text = _loadedText;
    }

}
```

```csharp: FileSaveSample.cs
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using SFB;
using System.IO;
using System.Text;
using System.Runtime.InteropServices;
using UnityEngine.Networking;
using UnityEngine.UI;
using UnityEngine.EventSystems;

[RequireComponent(typeof(Button))]
public class FileSaveSample : MonoBehaviour, IPointerDownHandler
{
    // ãƒ†ã‚­ã‚¹ãƒˆã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ
    [SerializeField] private Text outputText;

#if UNITY_WEBGL && !UNITY_EDITOR
    //
    // WebGL
    //

    // StandaloneFileBrowserã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‹ã‚‰å‘¼ã³å‡ºã™
    [DllImport("__Internal")]
    private static extern void DownloadFile(string gameObjectName, string methodName, string filename, byte[] byteArray, int byteArraySize);

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹
    public void OnPointerDown(PointerEventData eventData) {
        var str = outputText.text + "_saved";

        if (str.Length > 0)
        {
            var bytes = Encoding.UTF8.GetBytes(str);
            DownloadFile(gameObject.name, "OnFileDownload", "sample_saved.txt", bytes, bytes.Length);
        }
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã®å‡¦ç†
    public void OnFileDownload() {
        Debug.Log("CSV file saved");
        outputText.text = "File Saved";
    }

#else

    //
    // OSãƒ“ãƒ«ãƒ‰ & Unity editorä¸Š
    //

    public void OnPointerDown(PointerEventData eventData) { }

    void Start()
    {
        var button = GetComponent<Button>();
        button.onClick.AddListener(() => SaveFile());
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹
    public void SaveFile()
    {
        var str = outputText.text + "_saved";

        if (str.Length > 0)
        {
            var path = StandaloneFileBrowser.SaveFilePanel("ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜", "", "sample_saved", "txt");
            if (!string.IsNullOrEmpty(path))
            {
                File.WriteAllText(path, str);
                Debug.Log("File saved");
                outputText.text = "File Saved";
            }
        }
    }

#endif

}
```

`FileLoadSample.cs`ã¯`LoadButton`ã«ã€`FileSaveSample.cs`ã¯`SaveButton`ã«ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ãƒ“ãƒ¥ãƒ¼ã‚ˆã‚Šã€`Output`ãƒ†ã‚­ã‚¹ãƒˆã¸ã®å‚ç…§ã‚’æ¸¡ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/5782d6873ad7-20220831.png)

![](https://storage.googleapis.com/zenn-user-upload/5d76a3a7504a-20220831.png)

ã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚  
ã¾ãšã¯ãƒ­ãƒ¼ãƒ‰ã§ã™ã€‚`Load`ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‹ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/419777b3b668-20220831.png)

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã¨ã€è‰²ã€…ã‚¨ãƒ©ãƒ¼ã¯å‡ºãŸã¾ã¾ã§ã™ãŒã€ã¨ã‚Šã‚ãˆãšå‡ºåŠ›ç”¨ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/9f374145aab6-20220831.png)![](https://storage.googleapis.com/zenn-user-upload/9b2d0dae572b-20220831.png)

æ¬¡ã«ã‚»ãƒ¼ãƒ–ã§ã™ã€‚`Save`ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‹ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/86f6bcaa1304-20220831.png)

ä¿å­˜ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã¨ã€å…ˆã»ã©é–‹ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã«`_saved`ãŒè¿½è¨˜ã•ã‚Œã¦ä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/47a01bb4dfee-20220830.png)

# WebGLãƒ“ãƒ«ãƒ‰

[Build Settings...]â†’[WebGL]ã‚’é–‹ãã€`Switch Platform`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/936512f32a16-20220831.png)

ã—ã°ã‚‰ãå¾…ã¤ã¨å®Œäº†ã—ã¾ã™ãŒã€`Build`ãŒæŠ¼ã›ãªã„çŠ¶æ…‹ã«ãªã£ã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/e6074e304ecd-20220831.png)

[Player Settings]ã‚’é–‹ãã€[Player]â†’[Other Settings]ã‚’ç¢ºèªã™ã‚‹ã¨ã€`Color Space`ã¨`Lightmap Encoding`ã«æ³¨æ„æ›¸ããŒå‡ºã¦ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/a1bfa30ff580-20220831.png)

ãã‚Œãã‚Œã€`Gamma`ã¨`Normal Quality`ã«å¤‰æ›´ã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/d58e126708ee-20220831.png)

ãƒ“ãƒ«ãƒ‰ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€`Build And Run`ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚  
ä¿å­˜å…ˆã¯é©å½“ã«æŒ‡å®šã€‚ãƒ“ãƒ«ãƒ‰ã«ã¯æ•°åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/2761ae63d5e7-20220831.png)

# å‹•ä½œç¢ºèª

ãƒ“ãƒ«ãƒ‰ãŒçµ‚ã‚ã‚‹ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒè‡ªå‹•çš„ã«é–‹ãã¾ã™ã€‚  
ãƒœã‚¿ãƒ³ã‚µã‚¤ã‚ºãŒã‹ãªã‚Šå°ã•ããªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€‚ã€‚ã¨ã‚Šã‚ãˆãšèµ·å‹•ã—ã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/d4ea8be82297-20220831.png)

WebGLå¾Œã‚‚ã€`Load`ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å•é¡Œãªããƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‹ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/8bb0d9e88451-20220831.png)

`Save`ãƒœã‚¿ãƒ³ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/75ef97f3a73e-20220831.png)

ä»¥ä¸Šã€`UnityStandaloneFileBrowser`ã‚’ä½¿ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ç´°ã‹ã„æŒ™å‹•ã«ã¤ã„ã¦ã¯ã¾ã ç†è§£ã—ãã‚Œã¦ã„ãªã„ã®ã§ã€è‰²ã€…è©¦ã—ãªãŒã‚‰ç†è§£ã—ã¦ã„ããŸã„ã¨ã“ã‚ã§ã™ã€‚

# å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸè¨˜äº‹
- https://qiita.com/otochan/items/0f20fad94467bb2c2572
- https://baba-s.hatenablog.com/entry/2019/02/26/090000